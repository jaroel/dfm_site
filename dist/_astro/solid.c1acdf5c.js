const p={};function y(t){p.context=t}function j(){return{...p.context,id:`${p.context.id}${p.context.count++}-`,count:0}}const D=(t,e)=>t===e,G=Symbol("solid-proxy"),I=Symbol("solid-track"),w={equals:D};let T=N;const f=1,v=2,U={owned:null,cleanups:null,context:null,owner:null};var o=null;let h=null,l=null,i=null,a=null,C=0;function K(t,e){const n=l,s=o,r=t.length===0,u=r?U:{owned:null,cleanups:null,context:null,owner:e||s},c=r?t:()=>t(()=>x(()=>m(u)));o=u,l=null;try{return b(c,!0)}finally{l=n,o=s}}function M(t,e){e=e?Object.assign({},w,e):w;const n={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},s=r=>(typeof r=="function"&&(r=r(n.value)),O(n,r));return[k.bind(n),s]}function Q(t,e,n){const s=A(t,e,!1,f);g(s)}function V(t,e,n){T=d;const s=A(t,e,!1,f);s.user=!0,a?a.push(s):g(s)}function W(t,e,n){n=n?Object.assign({},w,n):w;const s=A(t,e,!0,0);return s.observers=null,s.observerSlots=null,s.comparator=n.equals||void 0,g(s),k.bind(s)}function X(t){return b(t,!1)}function x(t){const e=l;l=null;try{return t()}finally{l=e}}function Y(t){return o===null||(o.cleanups===null?o.cleanups=[t]:o.cleanups.push(t)),t}function q(){return l}function k(){const t=h;if(this.sources&&(this.state||t))if(this.state===f||t)g(this);else{const e=i;i=null,b(()=>E(this),!1),i=e}if(l){const e=this.observers?this.observers.length:0;l.sources?(l.sources.push(this),l.sourceSlots.push(e)):(l.sources=[this],l.sourceSlots=[e]),this.observers?(this.observers.push(l),this.observerSlots.push(l.sources.length-1)):(this.observers=[l],this.observerSlots=[l.sources.length-1])}return this.value}function O(t,e,n){let s=t.value;return(!t.comparator||!t.comparator(s,e))&&(t.value=e,t.observers&&t.observers.length&&b(()=>{for(let r=0;r<t.observers.length;r+=1){const u=t.observers[r],c=h&&h.running;c&&h.disposed.has(u),(c&&!u.tState||!c&&!u.state)&&(u.pure?i.push(u):a.push(u),u.observers&&R(u)),c||(u.state=f)}if(i.length>1e6)throw i=[],new Error},!1)),e}function g(t){if(!t.fn)return;m(t);const e=o,n=l,s=C;l=o=t,F(t,t.value,s),l=n,o=e}function F(t,e,n){let s;try{s=t.fn(e)}catch(r){t.pure&&(t.state=f,t.owned&&t.owned.forEach(m),t.owned=null),$(r)}(!t.updatedAt||t.updatedAt<=n)&&(t.updatedAt!=null&&"observers"in t?O(t,s):t.value=s,t.updatedAt=n)}function A(t,e,n,s=f,r){const u={fn:t,state:s,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:o,context:null,pure:n};return o===null||o!==U&&(o.owned?o.owned.push(u):o.owned=[u]),u}function S(t){const e=h;if(t.state===0||e)return;if(t.state===v||e)return E(t);if(t.suspense&&x(t.suspense.inFallback))return t.suspense.effects.push(t);const n=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<C);)(t.state||e)&&n.push(t);for(let s=n.length-1;s>=0;s--)if(t=n[s],t.state===f||e)g(t);else if(t.state===v||e){const r=i;i=null,b(()=>E(t,n[0]),!1),i=r}}function b(t,e){if(i)return t();let n=!1;e||(i=[]),a?n=!0:a=[],C++;try{const s=t();return H(n),s}catch(s){i||(a=null),$(s)}}function H(t){if(i&&(N(i),i=null),t)return;const e=a;a=null,e.length&&b(()=>T(e),!1)}function N(t){for(let e=0;e<t.length;e++)S(t[e])}function d(t){let e,n=0;for(e=0;e<t.length;e++){const s=t[e];s.user?t[n++]=s:S(s)}for(p.context&&y(),e=0;e<n;e++)S(t[e])}function E(t,e){const n=h;t.state=0;for(let s=0;s<t.sources.length;s+=1){const r=t.sources[s];r.sources&&(r.state===f||n?r!==e&&S(r):(r.state===v||n)&&E(r,e))}}function R(t){const e=h;for(let n=0;n<t.observers.length;n+=1){const s=t.observers[n];(!s.state||e)&&(s.state=v,s.pure?i.push(s):a.push(s),s.observers&&R(s))}}function m(t){let e;if(t.sources)for(;t.sources.length;){const n=t.sources.pop(),s=t.sourceSlots.pop(),r=n.observers;if(r&&r.length){const u=r.pop(),c=n.observerSlots.pop();s<r.length&&(u.sourceSlots[c]=s,r[s]=u,n.observerSlots[s]=c)}}if(t.owned){for(e=0;e<t.owned.length;e++)m(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function P(t){return t instanceof Error||typeof t=="string"?t:new Error("Unknown error")}function $(t){throw t=P(t),t}let L=!1;function z(){L=!0}function B(t,e){if(L&&p.context){const n=p.context;y(j());const s=x(()=>t(e||{}));return y(n),s}return x(()=>t(e||{}))}export{G as $,Q as a,M as b,B as c,V as d,W as e,K as f,z as g,I as h,q as i,X as j,Y as o,p as s};
